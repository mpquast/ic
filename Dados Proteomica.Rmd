---
title: "Dados Proteomica"
author: "Yasmine"
date: "24 de agosto de 2016"
output: html_document
---

#Objetivo

Queremos saber quais são as proteínas que têm abundância diferentes quando comparamos os controles aos afetados.

Vamos começar lendo os dados:
```{r dados}
library(readxl)
tabela=read_excel("20160718_BPDunifesp_proteinsmeasurements_nofilter.xlsx")
colnames(tabela)=tabela[2,]
tabela1=tabela[-c(1:2, 5557:9645),-c(2:11)]
dados=apply(tabela1[,-1], 2, as.double)
row.names(dados)=tabela1[[1]]
```

Vamos trabalhar somente com os "Controles" e "Afetados". Para enxergar melhor o comportamento dos dados vamos aplicar uma transformação nos mesmos. Somaremos, nesse caso,  1 e aplicaremos o log em base 2 em todas as observações de controle e afetados.

Aplicando a transformação:
```{r transformacao}
tran = function(x) log2(x+1)
n.dados=apply(dados, 2, tran)
```

Podemos plotar um histograma suavizado com a densidade dos dados
```{r densidade, warning=FALSE}
plot(density(n.dados), add=TRUE)
```

E podemos plotar a densidade para cada indivíduo:
```{r dens.ind, results='hide', fig.align='center'}
fit=apply(n.dados, 2, density)
matx=sapply(fit, '[[', 'x')
maty=sapply(fit, '[[', 'y')
matplot(matx,maty, type='l', lty=1)
```

Podemos estudar as correlações entre cada réplica de cada indivíduo. Para mostrar tais correlações podemos fazer alguns gráficos.

```{r, fig.cap="Gráfico de correlação entre as réplicas de cada indivíduo", fig.align='center'}
data=as.data.frame(n.dados, row.names =tabela1[[1]], col.names=tabela[2,])
corrplot(x, method="ellipse")
```

Para garantir que as correlações sejam calculadas para cada individuo entre suas réplicas corretamente, precisamos no certificar de que existam para cada um duas réplicas.

```{r}
nms = colnames(dados)
nms = gsub("--", "-", nms)
amostras = sapply(strsplit(nms, "-"), '[', 1)
replicas = sapply(strsplit(nms, "-"), '[', 2)
table(amostras, replicas)
```

Como podemos ver, cada um dos indivíduos, seja ele controle ou afetado, temos duas réplicas, com exceção do paciente afetado 73B, portanto não faremos essa análise para ele.

Então podemos calcular as correlações par a par e graficá-las.

```{r cor.pares, fig.cap="Gráfico de dispersão", fig.align='center'}
data=data[,-75]
x=rep(0,length(data)/2)
for (i in 1:(length(data)/2)) {
  x[i]=cor(data[,2*i-1],data[,2*i])
}
hist(x)
```
